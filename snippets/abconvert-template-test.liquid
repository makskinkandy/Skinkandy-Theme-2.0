<script id="ABConvert-template-test">
var abconvertTemplateTestLiquidVariables = { 
    abconvertTemplate : {{ template | json }},
    abconvertDesignMode:{{request.design_mode}}
 };

Object.keys(abconvertTemplateTestLiquidVariables).forEach(function(key) { window[key] =
abconvertTemplateTestLiquidVariables[key]; });
var abconvertTemplateTestDict = {"experiments":[]};
 window.abconvertTemplateTestDict = abconvertTemplateTestDict;
(()=>{"use strict";const e={NEW:"new",RETURNING:"returning",ALL:"all"},t=async(e,t,n=null)=>{const o={method:t,mode:"cors",headers:{"Content-Type":"application/json"}};n&&(o.body=JSON.stringify(n));let r=150,a=0;for(;a<3;)try{const t=await fetch(e,o);if(t.ok)return t.json();throw new Error(await t.json())}catch(e){if(r*=2,a+=1,a>=3)throw e;await new Promise((e=>setTimeout(e,r)))}throw new Error("API Error")};function n(e){for(var t=e+"=",n=document.cookie.split(";"),o=0;o<n.length;o++){for(var r=n[o];" "==r.charAt(0);)r=r.substring(1,r.length);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return null}function o(e,t,n){var o,r=new Date;r.setTime(r.getTime()+n),o="; expires="+r.toUTCString(),document.cookie=e+"="+(t||"")+o+"; path=/"}function r(){let e=n("abconvert-landing-page");return e||(e=window.location.pathname,o("abconvert-landing-page",e,18e5)),e}function a(){let e=n("abconvert-session");return e||(e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),o("abconvert-session",e,18e5)),e}function i(t){const n=(new Date).valueOf(),o=localStorage.getItem("abconvert-first-visit-time")?Number(localStorage.getItem("abconvert-first-visit-time")):n;return localStorage.getItem("abconvert-first-visit-time")||localStorage.setItem("abconvert-first-visit-time",n.toString()),o>(t=new Date(t).valueOf())?e.NEW:e.RETURNING}function c(e,t,n){switch(t){case"match_exactly":return e===n;case"match_regex_exactly":return new RegExp(n).test(e);case"contains":return e.includes(n);case"ends_with":return e.endsWith(n);case"starts_with":return e.startsWith(n);case"not_match_exactly":return e!==n;case"not_match_regex_exactly":return!new RegExp(n).test(e);case"not_contains":return!e.includes(n);case"not_ends_with":return!e.endsWith(n);case"not_starts_with":return!e.startsWith(n);default:return!1}}const s="https://app.abconvert.io";async function l(){localStorage.getItem("abconvert-country")||await async function(){const e=await fetch(`${s}/api/public/get-country-code`,{method:"GET",mode:"cors"}),t=(await e.json()).countryCode;t&&(console.log("successfully set country code: ",t),localStorage.setItem("abconvert-country",t))}()}function u(){return localStorage.getItem("abconvert-country")}function d(){const e=navigator.userAgent||window.opera;return/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(e)?"mobile":/ipad|playbook|silk/i.test(e)?"tablet":"desktop"}const p=[/Googlebot/,/Googlebot-Image/,/Googlebot-Video/,/Googlebot-News/,/Storebot-Google/,/Google-InspectionTool/,/GoogleOther/,/Google-Extended/,/APIs-Google/,/AdsBot-Google-Mobile/,/AdsBot-Google/,/Mediapartners-Google/,/Google-Safety/,/FeedFetcher-Google/,/GoogleProducer/,/Bingbot/,/Slurp/,/DuckDuckBot/,/Baiduspider/,/YandexBot/,/facebot/,/Twitterbot/];let g,v,m=0,f=0,w=!1;const h=()=>{w?(w=!1,v=(new Date).getTime(),f+=(v-g)/1e3):(w=!0,g=(new Date).getTime())};function b(e,t,c,s,l){const u=(new Date).getTime(),d=window.location.pathname.toString(),p=r();n(`abconvert-${t}-test-stay-time-recorded-${c}`)||(o(`abconvert-${t}-test-stay-time-recorded-${c}`,!0,18e5),setInterval((()=>{(new Date).getTime()-u>39e3&&h()}),39e3),window.addEventListener("beforeunload",(async()=>{const t=a(),n=(new Date).getTime(),o=(n-u)/1e3,r=(n-u)/1e3-m/1e3-f;fetch(e,{method:"POST",body:JSON.stringify({stayingTime:o,stayingTimeAdjusted:r,sessionId:t,experimentId:c,groupIndex:s,visitorType:i(l),pathName:d,landingPage:p}),keepalive:!0})})))}function y(e,t,n,o){const c=window.location.pathname.toString(),s=r();window.addEventListener("click",(r=>{if("A"===r.target.tagName){const l=r.target.getAttribute("href");console.log(l);const u=a();fetch(e,{method:"POST",body:JSON.stringify({sessionId:u,experimentId:t,groupIndex:n,link:l,visitorType:i(o),pathName:c,landingPage:s}),keepalive:!0})}}))}function x(e,t,n,o){const c=window.location.pathname.toString(),s=r();let l=!1;window.addEventListener("scroll",(()=>{l=!0})),window.addEventListener("click",(()=>{l=!0})),window.addEventListener("beforeunload",(async()=>{if(!l){const r=a();fetch(e,{method:"POST",body:JSON.stringify({sessionId:r,experimentId:t,groupIndex:n,visitorType:i(o),pathName:c,landingPage:s}),keepalive:!0})}}))}async function S(e,t,n,o){const c=a(),s=window.location.pathname.toString(),l=r();fetch(e,{method:"POST",body:JSON.stringify({sessionId:c,experimentId:t,groupIndex:n,visitorType:i(o),pathName:s,landingPage:l}),keepalive:!0})}window.addEventListener("scroll",(()=>{m+=1.8,h()}));var T=function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{s(o.next(e))}catch(e){a(e)}}function c(e){try{s(o.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((o=o.apply(e,t||[])).next())}))},I=function(e,t){var n,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,o&&(r=2&c[0]?o.return:c[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,c[1])).done)return r;switch(o=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,o=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!((r=(r=i.trys).length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){i=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){i.label=c[1];break}if(6===c[0]&&i.label<r[1]){i.label=r[1],r=c;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(c);break}r[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],o=0}finally{n=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};T(void 0,void 0,void 0,(function(){function e(){var e=new URLSearchParams(location.search),t=e.get("preview"),n=e.get("countryCode");return n&&window.sessionStorage.setItem("abconvert-country",n),t&&!isNaN(Number(t))?(window.sessionStorage.setItem("abconvert-preview-number",t),t):window.sessionStorage.getItem("abconvert-preview-number")}function n(e){var t,n=function(){var e=localStorage.getItem("abconvert-seed");return null==e&&(e=Math.floor(100*Math.random()).toString(),localStorage.setItem("abconvert-seed",e)),e}(),o=0;for(t=0;t<e.length;++t)if(o+=e[t].percentage,Number(n)<o)return t;return t}function o(){var t=e();return t&&!isNaN(Number(t))}function a(e){for(var t=e+"=",n=document.cookie.split(";"),o=0;o<n.length;o++){for(var r=n[o];" "==r.charAt(0);)r=r.substring(1,r.length);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return null}function g(e){var n,o,r,i,c,s,d,p=e.experimentId,g=e.groupIndex;return T(this,void 0,void 0,(function(){var e,v,m,f,w,h,b,y,x;return I(this,(function(S){switch(S.label){case 0:S.trys.push([0,8,,9]),e=0,S.label=1;case 1:return e<10?[4,l()]:[3,7];case 2:return S.sent(),[4,t((null!==(r=null===(o=null===(n=null===window||void 0===window?void 0:window.Shopify)||void 0===n?void 0:n.routes)||void 0===o?void 0:o.root)&&void 0!==r?r:"/")+"cart.js","GET")];case 3:return v=S.sent(),console.log("[LOG] Original cart attributes: ",v.attributes),m=v.attributes,f={},m["abconvert-template"]&&(f=JSON.parse(m["abconvert-template"])),f[p]=g,w={"abconvert-template":JSON.stringify(f),abconvertCountry:u(),abconvertSearchParams:null!==(i=a("abconvert-search-params"))&&void 0!==i?i:""},console.log("[LOG] New cart attributes: ",w),m["abconvert-template"]&&m["abconvert-template"]==JSON.stringify(f)?[3,5]:(h={"Content-Type":"application/json"},b=(null!==(d=null===(s=null===(c=null===window||void 0===window?void 0:window.Shopify)||void 0===c?void 0:c.routes)||void 0===s?void 0:s.root)&&void 0!==d?d:"/")+"cart/update.js",y=JSON.stringify({attributes:w}),[4,fetch(b,{method:"POST",headers:h,body:y})]);case 4:return S.sent().ok?console.log("[LOG] Successfully update cart attributes"):console.log("Failed to update cart attributes"),[3,6];case 5:return[3,7];case 6:return e++,[3,1];case 7:return[3,9];case 8:return x=S.sent(),console.log("[ERROR] Update cart attributes: ",x),[3,9];case 9:return[2]}}))}))}var v;return I(this,(function(t){v=function(){var e;localStorage.getItem("shopURL")||window.Shopify&&window.Shopify.shop&&(e=window.Shopify.shop,localStorage.setItem("shopURL",e),console.log("[LOG] Template test: set shop url"))},console.log("[ABConvert] Running ABConvert Template test - 1.0.0 + add country filter + device filter");try{if(window.Shopify?.designMode||window.abconvertDesignMode)return[2];r(),localStorage.getItem("abconvert-user-seed")||localStorage.setItem("abconvert-user-seed","0"),v(),document.addEventListener("DOMContentLoaded",v),function(){T(this,void 0,void 0,(function(){return I(this,(function(t){switch(t.label){case 0:return(()=>{const e=navigator.userAgent;return p.some((t=>t.test(e)))})()?[2]:window.abconvertTemplateTestDict?window.abconvertTemplateTestDict.fetchCountryCode?[4,l()]:[3,2]:[3,3];case 1:t.sent(),t.label=2;case 2:!function(t){for(var r,a,s,l,p=window.abconvertTemplate,g=window.location,v=0,m=t;v<m.length;v++){var f=m[v],w=f.templateDict,h=f.testGroups,b=f.experimentId,y=f.isFilteredByCountry,x=f.isFilteredByDevice,S=f.filteredCountries,T=f.selectedDevice,I=f.startTime,N=f.pathConditionType,O=f.pathConditions;if(y){var G=u();if(!S.includes(G))continue}if(!(x&&d()!==T||f.selectedVistorType&&f.selectedVistorType!=i(I))){var k=!0;if(N&&("exclude"===N&&(k=!O.some((function(e){return c(window.location.pathname,e.condition,e.value)}))),"include"===N&&(k=O.some((function(e){return c(window.location.pathname,e.condition,e.value)})))),k){var E=new URLSearchParams(g.search).get("view");if(w[p]&&0===w[p].groupIndex&&!E){var D=(s=h,(l=e())&&!isNaN(Number(l))?Number(l)>=s.length?0:Number(l):n(s));o()||localStorage.getItem("abconvert-template-test-".concat(b))||localStorage.setItem("abconvert-template-test-".concat(b),JSON.stringify({experimentId:b,groupIndex:D,startTime:I}));var L=h[D].template,P=L.suffix;if(((a=(r=L.key).lastIndexOf("."))<=0?r:r.substring(0,a))!==p)return void(g.search=(C=g.search,A="view",R=P,_=void 0,B=void 0,_=new RegExp("([?&])"+A+"=.*?(&|$)","i"),B=-1!==C.indexOf("?")?"&":"?",C.match(_)?C.replace(_,"$1"+A+"="+R+"$2"):C+B+A+"="+R))}}}}var C,A,R,_,B}(window.abconvertTemplateTestDict.experiments),function(e){for(var t=s+"/api/analytics/template/originalview",n=s+"/api/analytics/template/click",o=s+"/api/analytics/template/bounce",r=s+"/api/analytics/template/staying-time",c=0,l=e;c<l.length;c++){var u=l[c],d=u.experimentId,p=u.templateDict,v=u.startTime;if(p[window.abconvertTemplate]&&(!u.selectedVistorType||u.selectedVistorType===i(v))){var m=localStorage.getItem("abconvert-template-test-".concat(d)),f=a("abconvert-template-test-stay-time-recorded-".concat(d));if(m){var w=JSON.parse(m).groupIndex;w==p[window.abconvertTemplate].groupIndex&&(g({experimentId:d,groupIndex:w}),S(t,d,w,v),y(n,d,w,v),x(o,d,w,v),f||b(r,"template",d,w,v))}}}}(window.abconvertTemplateTestDict.experiments),t.label=3;case 3:return[2]}}))}))}()}catch(e){console.log("[ABConvert] Template test error: ",e.message)}return[2]}))}))})();
</script>